# 评课系统系统设计文档

## 目录

1. [文档目的](#文档目的)
2. [术语定义](#术语定义)
3. [系统架构概述](#系统架构概述)
4. [技术栈选型](#技术栈选型)
5. [系统组件设计](#系统组件设计)
6. [数据库设计](#数据库设计)
7. [API设计](#api设计)
8. [安全设计](#安全设计)
9. [性能优化设计](#性能优化设计)
10. [扩展性设计](#扩展性设计)

## 文档目的

本文档旨在详细描述评课系统的系统架构和设计，包括技术选型、系统组件、数据库设计、API设计等，为开发团队提供系统实现的技术指导。

## 术语定义

| 术语 | 解释 |
|------|------|
| 前端 | 微信小程序客户端，负责用户界面和交互 |
| 后端 | 服务器端应用，负责业务逻辑和数据处理 |
| API | 应用程序编程接口，前后端通信的接口 |
| 模型 | 数据实体及其属性和关系的抽象表示 |
| 视图 | 用户界面组件，负责展示数据 |
| 控制器 | 处理用户请求，协调模型和视图的组件 |
| RESTful API | 遵循REST架构风格的API设计规范 |

## 系统架构概述

评课系统采用前后端分离架构，由前端微信小程序和后端API服务组成。系统整体架构如下：

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  微信小程序前端  │────▶│   后端API服务   │────▶│     数据库      │
│                 │◀────│                 │◀────│                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 架构说明

1. **前端层**：基于微信小程序开发，负责用户界面展示和用户交互
2. **后端层**：基于Flask框架开发，提供RESTful API服务，处理业务逻辑
3. **数据层**：使用关系型数据库存储系统数据

## 技术栈选型

### 前端技术栈

| 技术/框架 | 版本 | 用途 | 选型理由 |
|-----------|------|------|----------|
| 微信小程序 | 最新 | 用户界面和交互 | 符合项目要求，拥有庞大的用户基础 |
| WXML | - | 页面结构描述 | 微信小程序官方模板语言 |
| WXSS | - | 页面样式定义 | 微信小程序官方样式语言 |
| JavaScript | ES6+ | 逻辑处理 | 成熟稳定，广泛应用于web前端开发 |
| WePY/mpvue | 最新 | 开发框架（可选） | 提高开发效率，支持组件化开发 |

### 后端技术栈

| 技术/框架 | 版本 | 用途 | 选型理由 |
|-----------|------|------|----------|
| Python | 3.8+ | 后端开发语言 | 语法简洁，生态丰富，适合快速开发 |
| Flask | 2.0+ | Web框架 | 轻量级，易于扩展，适合构建RESTful API |
| SQLAlchemy | 1.4+ | ORM框架 | 功能强大，支持多种数据库，简化数据库操作 |
| SQLite/MySQL | - | 数据库 | SQLite适合小型应用，MySQL适合生产环境 |
| Flask-CORS | 3.0+ | 跨域资源共享 | 解决前后端跨域问题 |
| Flask-JWT-Extended | 4.0+ | 身份验证 | 提供JWT认证机制 |
| Gunicorn | 20.0+ | WSGI服务器 | 用于生产环境部署 |
| Docker | 最新 | 容器化 | 简化部署，提高环境一致性 |

## 系统组件设计

### 前端组件

#### 1. 页面组件

| 组件名称 | 功能描述 | 主要模块 |
|---------|---------|----------|
| 首页 | 展示课程列表、搜索入口和排行榜 | 课程列表、搜索栏、排行榜入口 |
| 课程列表页 | 展示课程列表，支持筛选和排序 | 筛选器、排序器、课程卡片列表 |
| 课程详情页 | 展示课程详细信息和评价入口 | 课程信息、教师信息、评价汇总、操作入口 |
| 评价页面 | 展示和提交课程评价 | 评分组件、评论输入、标签选择 |
| 讨论区页面 | 课程讨论功能 | 讨论列表、发布框、回复组件 |
| 排行榜页面 | 课程排名展示 | 分类切换、排名列表 |

#### 2. 通用组件

| 组件名称 | 功能描述 | 参数说明 |
|---------|---------|----------|
| 评分组件 | 星级评分功能 | 默认评分、最大值、是否可交互 |
| 加载组件 | 数据加载状态展示 | 加载文本、加载动画类型 |
| 错误组件 | 错误信息展示 | 错误类型、错误信息、操作建议 |
| 空状态组件 | 空数据状态展示 | 空状态类型、提示文本、操作按钮 |
| 分页组件 | 分页功能 | 总页数、当前页、每页数量 |

### 后端组件

#### 1. API控制器

| 控制器名称 | 功能描述 | 主要API |
|-----------|---------|----------|
| 课程控制器 | 处理课程相关请求 | 获取课程列表、获取课程详情、搜索课程 |
| 评价控制器 | 处理评价相关请求 | 提交评价、获取评价列表、点赞评价 |
| 讨论控制器 | 处理讨论相关请求 | 获取讨论列表、发表讨论、回复讨论、点赞讨论 |
| 教师控制器 | 处理教师相关请求 | 获取教师信息 |
| 统计控制器 | 处理统计相关请求 | 获取排行榜数据、获取评价统计 |

#### 2. 服务层

| 服务名称 | 功能描述 | 主要方法 |
|---------|---------|----------|
| 课程服务 | 课程业务逻辑 | 获取课程列表、获取课程详情、搜索课程 |
| 评价服务 | 评价业务逻辑 | 创建评价、获取评价列表、更新评价统计 |
| 讨论服务 | 讨论业务逻辑 | 获取讨论、创建讨论、回复讨论 |
| 教师服务 | 教师业务逻辑 | 获取教师信息 |
| 统计服务 | 统计业务逻辑 | 计算排行榜、生成统计数据 |
| 验证服务 | 数据验证逻辑 | 验证请求参数、验证用户输入 |

#### 3. 模型层

| 模型名称 | 功能描述 | 关联关系 |
|---------|---------|----------|
| 教师模型 | 教师数据实体 | 一对多：教师->课程 |
| 课程模型 | 课程数据实体 | 多对一：课程->教师<br>一对多：课程->评价<br>一对多：课程->评论 |
| 评价模型 | 评价数据实体 | 多对一：评价->课程 |
| 评论模型 | 评论数据实体 | 多对一：评论->课程<br>自引用：评论->父评论 |

## 数据库设计

### 表结构

#### 1. teachers（教师表）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 教师ID |
| name | VARCHAR(100) | NOT NULL | 教师姓名 |
| department | VARCHAR(100) | NOT NULL | 所属学院 |
| title | VARCHAR(100) | NOT NULL | 职称 |
| introduction | TEXT | | 教师简介 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 2. courses（课程表）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 课程ID |
| course_code | VARCHAR(50) | NOT NULL, UNIQUE | 课程代码 |
| name | VARCHAR(200) | NOT NULL | 课程名称 |
| description | TEXT | | 课程描述 |
| credit | INT | NOT NULL | 学分 |
| semester | VARCHAR(50) | NOT NULL | 学期 |
| teacher_id | INT | NOT NULL, FOREIGN KEY REFERENCES teachers(id) | 授课教师ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 3. evaluations（评价表）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 评价ID |
| course_id | INT | NOT NULL, FOREIGN KEY REFERENCES courses(id) | 课程ID |
| user_id | VARCHAR(100) | NOT NULL | 用户标识 |
| score | INT | NOT NULL, CHECK (score BETWEEN 1 AND 5) | 总评分 |
| workload_score | INT | NOT NULL, CHECK (workload_score BETWEEN 1 AND 5) | 工作量评分 |
| content_score | INT | NOT NULL, CHECK (content_score BETWEEN 1 AND 5) | 内容评分 |
| teaching_score | INT | NOT NULL, CHECK (teaching_score BETWEEN 1 AND 5) | 教学评分 |
| tags | TEXT | | 标签（JSON格式） |
| comment | TEXT | | 评价内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| likes | INT | DEFAULT 0 | 点赞数 |

#### 4. comments（评论表）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 评论ID |
| course_id | INT | NOT NULL, FOREIGN KEY REFERENCES courses(id) | 课程ID |
| user_id | VARCHAR(100) | NOT NULL | 用户标识 |
| user_name | VARCHAR(100) | NOT NULL | 用户昵称 |
| content | TEXT | NOT NULL | 评论内容 |
| parent_id | INT | NULL, FOREIGN KEY REFERENCES comments(id) | 父评论ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| likes | INT | DEFAULT 0 | 点赞数 |

### 索引设计

| 表名 | 索引字段 | 索引类型 | 描述 |
|------|----------|----------|------|
| courses | teacher_id | 普通索引 | 加速通过教师ID查询课程 |
| courses | course_code | 唯一索引 | 确保课程代码唯一性，加速查询 |
| courses | name | 全文索引 | 加速课程名称搜索 |
| evaluations | course_id | 普通索引 | 加速通过课程ID查询评价 |
| evaluations | user_id, course_id | 组合索引 | 防止重复评价，加速查询 |
| comments | course_id | 普通索引 | 加速通过课程ID查询评论 |
| comments | parent_id | 普通索引 | 加速查询评论回复 |

## API设计

### 课程相关API

#### 1. 获取课程列表

| 属性 | 内容 |
|------|------|
| URL | `/api/courses` |
| 方法 | `GET` |
| 功能描述 | 获取课程列表，支持筛选和分页 |
| 请求参数 | department: 学院（可选）<br>semester: 学期（可选）<br>page: 页码（可选，默认1）<br>per_page: 每页数量（可选，默认20） |
| 成功响应 | 200 OK<br>`{"total": 100, "data": [{"id": 1, "course_code": "CS101", "name": "计算机基础", ...}], "page": 1, "per_page": 20}` |
| 错误响应 | 400 Bad Request<br>`{"error": "参数错误"}` |

#### 2. 获取课程详情

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/{id}` |
| 方法 | `GET` |
| 功能描述 | 获取课程详细信息 |
| 路径参数 | id: 课程ID |
| 成功响应 | 200 OK<br>`{"id": 1, "course_code": "CS101", "name": "计算机基础", "teacher": {...}, ...}` |
| 错误响应 | 404 Not Found<br>`{"error": "课程不存在"}` |

#### 3. 搜索课程

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/search` |
| 方法 | `GET` |
| 功能描述 | 根据关键词搜索课程 |
| 请求参数 | keyword: 搜索关键词<br>page: 页码（可选，默认1）<br>per_page: 每页数量（可选，默认20） |
| 成功响应 | 200 OK<br>`{"total": 10, "data": [{"id": 1, "course_code": "CS101", "name": "计算机基础", ...}], "page": 1, "per_page": 20}` |
| 错误响应 | 400 Bad Request<br>`{"error": "搜索关键词不能为空"}` |

### 评价相关API

#### 1. 提交评价

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/{course_id}/evaluations` |
| 方法 | `POST` |
| 功能描述 | 提交课程评价 |
| 路径参数 | course_id: 课程ID |
| 请求体 | `{"user_id": "...", "score": 5, "workload_score": 4, "content_score": 5, "teaching_score": 5, "tags": ["标签1", "标签2"], "comment": "评价内容"}` |
| 成功响应 | 201 Created<br>`{"id": 1, "course_id": 1, ...}` |
| 错误响应 | 400 Bad Request<br>`{"error": "参数错误"}`<br>404 Not Found<br>`{"error": "课程不存在"}` |

#### 2. 获取课程评价列表

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/{course_id}/evaluations` |
| 方法 | `GET` |
| 功能描述 | 获取课程的评价列表 |
| 路径参数 | course_id: 课程ID |
| 请求参数 | page: 页码（可选，默认1）<br>per_page: 每页数量（可选，默认20）<br>sort: 排序方式（可选，默认"latest"） |
| 成功响应 | 200 OK<br>`{"total": 50, "data": [{"id": 1, "user_id": "...", "score": 5, ...}], "page": 1, "per_page": 20}` |
| 错误响应 | 404 Not Found<br>`{"error": "课程不存在"}` |

### 讨论相关API

#### 1. 获取课程讨论列表

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/{course_id}/comments` |
| 方法 | `GET` |
| 功能描述 | 获取课程的讨论列表 |
| 路径参数 | course_id: 课程ID |
| 请求参数 | page: 页码（可选，默认1）<br>per_page: 每页数量（可选，默认20）<br>sort: 排序方式（可选，默认"latest"） |
| 成功响应 | 200 OK<br>`{"total": 30, "data": [{"id": 1, "user_id": "...", "user_name": "...", "content": "...", "replies": [...]}], "page": 1, "per_page": 20}` |
| 错误响应 | 404 Not Found<br>`{"error": "课程不存在"}` |

#### 2. 发表讨论

| 属性 | 内容 |
|------|------|
| URL | `/api/courses/{course_id}/comments` |
| 方法 | `POST` |
| 功能描述 | 在课程讨论区发表内容 |
| 路径参数 | course_id: 课程ID |
| 请求体 | `{"user_id": "...", "user_name": "...", "content": "讨论内容"}` |
| 成功响应 | 201 Created<br>`{"id": 1, "course_id": 1, ...}` |
| 错误响应 | 400 Bad Request<br>`{"error": "参数错误"}`<br>404 Not Found<br>`{"error": "课程不存在"}` |

#### 3. 回复讨论

| 属性 | 内容 |
|------|------|
| URL | `/api/comments/{comment_id}/replies` |
| 方法 | `POST` |
| 功能描述 | 回复现有讨论 |
| 路径参数 | comment_id: 父评论ID |
| 请求体 | `{"user_id": "...", "user_name": "...", "content": "回复内容"}` |
| 成功响应 | 201 Created<br>`{"id": 2, "parent_id": 1, ...}` |
| 错误响应 | 400 Bad Request<br>`{"error": "参数错误"}`<br>404 Not Found<br>`{"error": "父评论不存在"}` |

### 排行榜相关API

#### 1. 获取课程排行榜

| 属性 | 内容 |
|------|------|
| URL | `/api/rankings/courses` |
| 方法 | `GET` |
| 功能描述 | 获取课程排行榜 |
| 请求参数 | category: 排名分类（可选，默认"overall"）<br>limit: 返回数量（可选，默认20） |
| 成功响应 | 200 OK<br>`{"data": [{"course_id": 1, "course_name": "...", "teacher_name": "...", "score": 4.8, "rank": 1}]}` |
| 错误响应 | 400 Bad Request<br>`{"error": "无效的分类"}` |

## 安全设计

### 1. 数据传输安全

- 所有API请求必须使用HTTPS加密传输
- 使用WAF（Web应用防火墙）防止常见的Web攻击

### 2. 输入验证与过滤

- 所有用户输入必须进行严格验证和过滤
- 使用参数化查询防止SQL注入
- 对特殊字符进行转义，防止XSS攻击

### 3. 访问控制

- 实施基于角色的访问控制（RBAC）
- 敏感操作需要身份验证
- 实施请求速率限制，防止暴力攻击

### 4. 数据安全

- 敏感数据加密存储
- 定期进行数据备份
- 实施数据库审计日志

## 性能优化设计

### 1. 数据库优化

- 合理设计索引，优化查询性能
- 使用查询缓存减少数据库负载
- 对于频繁访问的数据，使用Redis缓存

### 2. API优化

- 实施API响应缓存
- 对大型数据集使用分页加载
- 优化API请求参数，减少不必要的数据传输

### 3. 前端优化

- 组件懒加载
- 图片优化和压缩
- 使用缓存减少网络请求

## 扩展性设计

### 1. 水平扩展

- 后端服务无状态化设计，支持水平扩展
- 数据库读写分离，支持主从复制

### 2. 模块化设计

- 采用微服务架构思想，服务之间低耦合高内聚
- 接口标准化，便于服务扩展和替换

### 3. 配置管理

- 使用环境变量管理配置，便于不同环境部署
- 支持动态配置更新，无需重启服务

---

本文档详细描述了评课系统的系统设计，包括架构设计、技术选型、组件设计、数据库设计和API设计等方面。通过合理的系统设计，可以确保系统的可靠性、安全性和可扩展性，满足用户的需求。