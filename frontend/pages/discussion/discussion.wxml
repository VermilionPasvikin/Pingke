<view class="container">
  <!-- è¯„è®ºåŒºå¤´éƒ¨ä¿¡æ¯ -->
  <view class="header">
    <view class="course-info">
      <view class="course-name">{{courseInfo.name}}</view>
      <view class="course-meta">{{courseInfo.teacher ? courseInfo.teacher.name : '-'}} Â· {{courseInfo.credit || 0}}å­¦åˆ†</view>
    </view>
  </view>

  <!-- è¯„è®ºåˆ—è¡¨ -->
  <view class="discussion-list">
    <view wx:for="{{discussions}}" wx:key="id" class="discussion-item">
      <view class="discussion-header">
        <view class="user-info">
          <view class="avatar">{{item.author.substring(0, 1)}}</view>
          <view class="user-meta">
            <view class="username">{{item.author}}</view>
            <view class="time">{{item.created_at}}</view>
          </view>
        </view>
      </view>
      
      <view class="discussion-content">{{item.content}}</view>
      
      <view class="discussion-actions">
        <view class="action-item" bindtap="likeDiscussion" data-id="{{item.id}}">
          <text class="icon" style="color: {{item.is_liked ? '#1aad19' : '#999'}};">{{item.is_liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="count">{{item.likes_count}}</text>
        </view>
        <view class="action-item" bindtap="replyDiscussion" data-id="{{item.id}}">
          <text class="icon" style="color: #999;">ğŸ’¬</text>
          <text class="count">{{item.replies_count}}</text>
        </view>
      </view>
      
      <!-- å›å¤åˆ—è¡¨ -->
      <view class="replies-container" wx:if="{{item.replies && item.replies.length > 0}}">
        <view wx:for="{{item.replies}}" wx:for-item="reply" wx:key="reply_id" class="reply-item">
          <view class="reply-content">
            <text class="reply-author">{{reply.author}}:</text>
            <text class="reply-text">{{reply.content}}</text>
          </view>
          <view class="reply-meta">
            <text class="reply-time">{{reply.created_at}}</text>
            <text class="reply-like" bindtap="likeReply" data-discussion-id="{{item.id}}" data-reply-id="{{reply.id}}">
              {{reply.is_liked ? 'å·²èµ' : 'ç‚¹èµ'}} ({{reply.likes_count}})
            </text>
          </view>
        </view>
        <view wx:if="{{item.showAllReplies || item.replies.length <= 3}}" class="reply-input-container">
          <textarea class="reply-input" placeholder="å›å¤..." bindinput="onReplyInput" data-id="{{item.id}}" value="{{replyInputs[item.id] || ''}}" auto-height maxlength="-1" show-confirm-bar="false" />
          <button class="reply-btn" bindtap="submitReply" data-id="{{item.id}}">å‘é€</button>
        </view>
        <view class="toggle-replies" wx:if="{{!item.showAllReplies && item.replies.length > 3}}" bindtap="toggleReplies" data-id="{{item.id}}">
          æŸ¥çœ‹å…¨éƒ¨{{item.replies_count}}æ¡å›å¤
        </view>
      </view>
      
      <view class="no-replies" wx:if="{{!item.replies || item.replies.length === 0}}">
        <view class="reply-input-container">
          <textarea class="reply-input" placeholder="å›å¤..." bindinput="onReplyInput" data-id="{{item.id}}" value="{{replyInputs[item.id] || ''}}" auto-height maxlength="-1" show-confirm-bar="false" />
          <button class="reply-btn" bindtap="submitReply" data-id="{{item.id}}">å‘é€</button>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text>{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€æç¤º -->
    <view class="empty-tip" wx:if="{{discussions.length === 0 && !loading}}">
      <text>æš‚æ— è®¨è®ºå†…å®¹ï¼Œå¿«æ¥åˆ†äº«ä½ çš„æƒ³æ³•å§ï¼</text>
    </view>
  </view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥æ¡† -->
  <view class="bottom-input">
    <textarea class="main-input" placeholder="åˆ†äº«ä½ çš„å­¦ä¹ ç»éªŒå’Œæƒ³æ³•..." bindinput="onMainInput" value="{{mainInput}}" auto-height maxlength="-1" show-confirm-bar="false" />
    <button class="send-btn" bindtap="submitDiscussion" disabled="{{!mainInput}}">å‘é€</button>
  </view>
</view>