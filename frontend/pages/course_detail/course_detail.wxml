<view class="container">
  <!-- è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ -->
  <view class="course-header">
    <text class="course-name">{{course.name}}</text>
    <text class="course-code">{{course.course_code}}</text>
    <view class="course-rating">
      <text class="score">{{course.avg_score || 'æš‚æ— è¯„åˆ†'}}</text>
      <text class="evaluation-count">{{course.evaluation_count || 0}}äººè¯„ä»·</text>
    </view>
  </view>

  <!-- è¯¾ç¨‹è¯¦ç»†ä¿¡æ¯ -->
  <view class="info-section">
    <view class="info-item">
      <text class="label">å­¦åˆ†ï¼š</text>
      <text class="value">{{course.credit || '-'}}</text>
    </view>
    <view class="info-item">
      <text class="label">æ•™å¸ˆï¼š</text>
      <text class="value">{{course.teacher ? course.teacher.name : '-'}}</text>
    </view>
    <view class="info-item">
      <text class="label">å­¦é™¢ï¼š</text>
      <text class="value">{{course.department || '-'}}</text>
    </view>
    <view class="info-item">
      <text class="label">å­¦æœŸï¼š</text>
      <text class="value">{{course.semester || '-'}}</text>
    </view>
    <view class="info-item">
      <text class="label">ç®€ä»‹ï¼š</text>
      <text class="value">{{course.description || 'æš‚æ— ç®€ä»‹'}}</text>
    </view>
  </view>

  <!-- çƒ­é—¨æ ‡ç­¾ -->
  <view class="tags-section">
    <text class="section-title">çƒ­é—¨æ ‡ç­¾</text>
    <view class="tags">
      <block wx:if="{{popularTags && popularTags.length > 0}}">
        <text wx:for="{{popularTags}}" wx:key="index" class="tag">{{item.name}} ({{item.count}})</text>
      </block>
      <text wx:else class="empty">æš‚æ— æ ‡ç­¾</text>
    </view>
  </view>

  <!-- è¯„ä»·åŒºåŸŸ -->
  <view class="evaluation-section">
    <view class="section-header">
      <text class="section-title">ç”¨æˆ·è¯„ä»·</text>
      <text class="section-more" bindtap="navigateToEvaluationList">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <!-- è¯„åˆ†ç»Ÿè®¡ -->
    <view class="rating-stats">
      <view class="score-circle">
        <text class="circle-score">{{course.avg_score || '0.0'}}</text>
      </view>
      <view class="rating-distribution">
        <view wx:for="{{[5,4,3,2,1]}}" wx:key="index" class="rating-item">
          <text class="rating-star">{{item}}æ˜Ÿ</text>
          <view class="rating-bar">
            <view class="rating-fill" style="width: {{ratingDistribution[item] || 0}}%"></view>
          </view>
          <text class="rating-percent">{{ratingDistribution[item] || 0}}%</text>
        </view>
      </view>
    </view>
    
    <!-- æœ€æ–°è¯„ä»· -->
    <view class="evaluation-list">
      <block wx:if="{{recentEvaluations && recentEvaluations.length > 0}}">
        <view wx:for="{{recentEvaluations}}" wx:key="id" class="evaluation-item">
          <view class="evaluation-header">
            <text class="evaluator">{{item.user_name || 'åŒ¿åç”¨æˆ·'}}</text>
            <text class="evaluation-date">{{item.created_at}}</text>
          </view>
          <view class="evaluation-score">
            <text class="score-text">åˆ†æ•°ï¼š{{item.score || 0}}</text>
          </view>
          <text class="evaluation-content">{{item.comment || 'æš‚æ— è¯„è®ºå†…å®¹'}}</text>
          <view class="evaluation-tags">
            <block wx:if="{{item.tags && item.tags.length > 0}}">
              <text wx:for="{{item.tags}}" wx:key="index" class="tag">{{item}}</text>
            </block>
            <text wx:else class="empty">æš‚æ— æ ‡ç­¾</text>
          </view>
          <view class="evaluation-actions">
            <text class="action" bindtap="likeEvaluation" data-id="{{item.id}}">
              <text class="icon">{{item.is_liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              <text>{{item.likes_count || 0}}</text>
            </text>
          </view>
        </view>
      </block>
      <view wx:else class="empty">æš‚æ— è¯„ä»·</view>
    </view>
  </view>

  <!-- è¯„è®ºåŒº -->
  <view class="comments-section">
    <view class="section-header">
      <text class="section-title">è¯¾ç¨‹è®¨è®º</text>
      <text class="section-more" bindtap="navigateToComments">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="comments-list">
      <block wx:if="{{recentComments && recentComments.length > 0}}">
        <view wx:for="{{recentComments}}" wx:key="id" class="comment-item">
          <view class="comment-header">
            <text class="commenter">{{item.user_name || 'åŒ¿åç”¨æˆ·'}}</text>
            <text class="comment-date">{{item.created_at}}</text>
          </view>
          <text class="comment-content">{{item.content}}</text>
          <view class="comment-actions">
            <text class="action" bindtap="likeComment" data-id="{{item.id}}">
              <text class="icon">{{item.is_liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              <text>{{item.likes_count || 0}}</text>
            </text>
            <text class="action" bindtap="replyComment" data-id="{{item.id}}">å›å¤ ({{item.replies_count || 0}})</text>
          </view>
        </view>
      </block>
      <view wx:else class="empty">æš‚æ— è®¨è®º</view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <button class="action-btn" type="primary" bindtap="writeEvaluation">å†™è¯„ä»·</button>
    <button class="action-btn" type="default" bindtap="writeComment">å‚ä¸è®¨è®º</button>
  </view>
</view>